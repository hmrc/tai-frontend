@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import includes.ptaHeader
@import uk.gov.hmrc.tai.util.{TaxYearRangeUtil => Dates}
@import incomeTaxComparison._
@import uk.gov.hmrc.tai.config.ApplicationConfig
@import uk.gov.hmrc.tai.viewModels.incomeTaxComparison.{IncomeTaxComparisonViewModel, EstimatedIncomeTaxComparisonViewModel}
@import uk.gov.hmrc.tai.model.TaxYear
@import scala.concurrent.ExecutionContext
@import includes.link
@import controllers.auth.AuthenticatedRequest

@this(mainTemplate: MainTemplate)


@(incomeTaxComparisonViewModel: IncomeTaxComparisonViewModel, appConfig: ApplicationConfig)(implicit request: AuthenticatedRequest[_], messages: Messages, templateRenderer: uk.gov.hmrc.renderer.TemplateRenderer,  ec: ExecutionContext)

@backLinkToChooseTaxYear = {
    <p class="flush--bottom">
        @includes.link(
            id=Some("returnToChooseTaxYearLink"),
            url=routes.WhatDoYouWantToDoController.whatDoYouWantToDoPage.url,
            copy=messages("your.paye.income.tax.overview"),
            linkClasses=Seq("link-back")
        )
    </p>
}

@headingText = @{
    incomeTaxComparisonViewModel.estimatedIncomeTaxComparisonViewModel.taxComparison.fold(
        _ => messages("tai.incomeTaxComparison.heading.more"),
        _ => messages("tai.incomeTaxComparison.heading.less"),
             messages("tai.incomeTaxComparison.heading.same")
    )
}

@header = @{
    ptaHeader(
        displayBackLink = true,
        mainHeadingText = headingText,
        preHeadingText = incomeTaxComparisonViewModel.username,
        preHeadingAccessibleAnnouncement = messages("tai.incomeTaxComparison.preHeading.screenReader"),
        customBackLinkContent = Some(backLinkToChooseTaxYear))
}


@mainTemplate(title = headingText,
    pageHeader = Some(header),
    authedUser = Some(request.taiUser)) {

    <div class="grid-row">
        <div class="column-two-thirds">
            @if(incomeTaxComparisonViewModel.isEstimatedCYPlusOneJourneyCompleted){
                <div class="tai-progress-panel" id="estimatedPayCompletionBanner">
                    <h2 class="heading-small flush-bottom flush--top" id="incomeSummary-banner-heading">
                        @messages("tai.incomeTaxComparison.taxCodes.banner")
                    </h2>
                </div>
            }

            <div class="section" id="incomeTax">
                @IncomeTax(incomeTaxComparisonViewModel.estimatedIncomeTaxComparisonViewModel)
            </div>

            <div class="section" id="incomeSummary">
                @IncomeSummary(incomeTaxComparisonViewModel.incomeSourceComparisonViewModel)
            </div>

            <div class="section" id="taxCodes">
                @TaxCodes(incomeTaxComparisonViewModel.taxCodeComparisonViewModel, appConfig)
            </div>

            <div class="section" id="taxFreeAmount">
                @TaxFreeAmount(incomeTaxComparisonViewModel.taxFreeAmountComparisonViewModel)
            </div>

            <div class="section" id="whatHappensNext">
                <h2 class="heading-large" id="whatHappensNextHeading">@messages("tai.incomeTaxComparison.whatHappensNext.subHeading")</h2>


                <p>@messages("tai.incomeTaxComparison.whatHappensNext.doNotDoAnything.text")</p>
                <p>@messages("tai.incomeTaxComparison.whatHappensNext.estimationApplyDate.text",s"${Dates.formatDate(TaxYear().next.start)}")</p>
                <p>@messages("tai.incomeTaxComparison.whatHappensNext.calculationMayChange.text")</p>

                <h3 class="heading-medium">@messages("tai.incomeTaxComparison.whatHappensNext.ifInformationWrongOrIncomplete.heading")</h3>
                <p>@messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.description",s"${Dates.formatDate(TaxYear().next.start)}")</p>


                <ul class="list list-bullet margin-bottom-large">
                    <li>
                        @link(
                            id = Some("companyBenefitsLink"),
                            url = appConfig.companyBenefitsLinkUrl,
                            copy = messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.companyBenefitsText"),
                            altCopy = Some(messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.companyBenefitsReaderText"))
                        )
                    </li>

                    <li>
                        @link(
                            id = Some("allowancesTaxReliefsLink"),
                            url = appConfig.taxFreeAllowanceLinkUrl,
                            copy = messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.allowanceTaxReliefText"),
                            altCopy = Some(messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.allowanceTaxReliefReaderText"))
                        )
                    </li>

                    <li>
                        @link(
                            id = Some("otherIncomeLink"),
                            url = appConfig.otherIncomeLinkUrl,
                            copy = messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.otherIncomeText"),
                            altCopy = Some(messages("tai.incomeTaxComparison.whatHappensNext.tellAboutChange.otherIncomeReaderText"))
                        )
                    </li>
                </ul>
            </div>

            <p>
                @link(
                id=Some("returnToPAYEIncomeOverviewLink"),
                url=routes.WhatDoYouWantToDoController.whatDoYouWantToDoPage.url,
                copy=messages("tai.incomeTaxComparison.returnToPAYEIncomeTaxOverview.link"))
            </p>

        </div>
    </div>
}
