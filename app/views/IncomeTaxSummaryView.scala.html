@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.tai.viewModels.TaxAccountSummaryViewModel
@import uk.gov.hmrc.play.views.html.helpers._
@import includes.ptaHeader
@import uk.gov.hmrc.tai.config.ApplicationConfig
@import uk.gov.hmrc.tai.viewModels.IFormInProgressBannerViewModel
@import includes.link

@import controllers.auth.AuthenticatedRequest

@this(mainTemplate: MainTemplate)

@(viewModel: TaxAccountSummaryViewModel, appConfig: ApplicationConfig
)(implicit request: AuthenticatedRequest[_],
  messages: Messages,
  templateRenderer: uk.gov.hmrc.renderer.TemplateRenderer,
  ec: scala.concurrent.ExecutionContext)


@backLinkToChooseTaxYear = {
    <p class="flush--bottom">
        @link(
            id=Some("returnToChooseTaxYearLink"),
            url=routes.WhatDoYouWantToDoController.whatDoYouWantToDoPage.url,
            copy=Messages("tai.returnToChooseTaxYear"),
            linkClasses=Seq("link-back")
        )
    </p>
}

@header = @{
    ptaHeader(
        displayBackLink = true,
        mainHeadingText = viewModel.header,
        preHeadingText = request.fullName,
        preHeadingAccessibleAnnouncement = "This section is the income tax summary for",
        customBackLinkContent = Some(backLinkToChooseTaxYear))
}

@mainTemplate(
    title = viewModel.title,
    authedUser = Some(request.taiUser),
    pageHeader = Some(header),
    articleClasses = Some("full-width")
    ){

@includes.iFormInProgressBanner(IFormInProgressBannerViewModel(viewModel.isAnyFormInProgress), appConfig)

<div class="grid-row">
    <div class="grid grid-2-3">
        <div class="inner-block">
            @if(viewModel.displayIyaBanner){
            <p id="inYearAdjustmentBanner" class="panel-indent panel-indent--info flush--top">
                <span class="display-block">@Messages("tai.notifications.iya.banner.text")</span>
                @link(
                    url=routes.PotentialUnderpaymentController.potentialUnderpaymentPage().url,
                    copy=Messages("tai.notifications.iya.linkText")
                )
            </p>
            }

            @if(viewModel.employments.nonEmpty){
            <div id="incomeFromEmploymentSection" class="section flush--bottom">

                <h2 id="incomeFromEmploymentHeading" class="heading-section">@Messages("tai.incomeTaxSummary.employment.section.heading")</h2>

                @incomeTaxSummary_incomeSourceDetail(viewModel.employments, "employment", Messages("tai.incomeTaxSummary.incomeAmount.prefix"))

            </div>
            }

            @if(viewModel.pensions.nonEmpty){
            <div id="incomeFromPensionSection" class="section flush--bottom">

                <h2 id="incomeFromPensionHeading" class="heading-section">@Messages("tai.incomeTaxSummary.pension.section.heading")</h2>

                @incomeTaxSummary_incomeSourceDetail(viewModel.pensions, "pension", Messages("tai.incomeTaxSummary.incomeAmount.prefix"))

            </div>
            }

            @if(viewModel.otherIncomeSources.nonEmpty){
            <div id="otherIncomeSources" class="section flush--bottom">

                <h2 id="otherIncomeSourcesHeading" class="heading-section">@Messages("tai.incomeTaxSummary.otherIncomeSources.heading")</h2>

                @incomeTaxSummary_incomeSourceDetail(viewModel.otherIncomeSources, "otherIncomeSources", Messages("tai.incomeTaxSummary.incomeAmount.prefix"))

            </div>
            }

            @if(viewModel.ceasedEmployments.nonEmpty){
            <div id="endedIncomeSection" class="section">

                <h2 id="endedIncomeHeading" class="heading-section">@Messages("tai.incomeTaxSummary.ceased.section.heading", viewModel.lastTaxYearEnd)</h2>

                @if(viewModel.rtiAvailable) {
                    @incomeTaxSummary_incomeSourceDetail(viewModel.ceasedEmployments, "income", Messages("tai.incomeTaxSummary.ceasedIncomeAmount.prefix"))
                } else {
                    <p>@messages("tai.rti.down.ceasedEmployments")</p>
                }

            </div>
            }

        </div>

    </div>

    <div class="grid grid-1-3">
        <div class="inner-block">

            <div id="annualAmountsSummarySection" class="section section__box--shaded flush--bottom">

                <h2 id="annualAmountsSummaryHeading" class="heading-section">@Messages("tai.incomeTaxSummary.annualAmounts.section.heading")</h2>

                <div id="incomeTaxSummaryTotalEstimatedIncome" aria-hidden="true">

                <h3>@Messages("tai.incomeTaxSummary.annualAmounts.section.totalIncomeHeading")</h3>
                <p class="flush--bottom">@Messages("tai.incomeTaxSummary.annualAmounts.section.totalIncomePara")</p>
                <p class="flush">
                    <span class="visually-hidden">@Messages("tai.incomeTaxSummary.generalAmount.prefix") </span>
                    <span class="display-block heading-36 faded-text-dark section--narrow flush">@viewModel.totalEstimatedIncome</span>
                </p>

                <p class="flush--top">
                    @link(
                        id=Some("totalEstimatedIncomeLink"),
                        url=routes.EstimatedIncomeTaxController.estimatedIncomeTax.url,
                        copy=Messages("tai.incomeTaxSummary.annualAmounts.section.incomeTaxLink")
                    )
                </p>

                </div>


                <h3>@Messages("tai.incomeTaxSummary.annualAmounts.section.taxFreeHeading")</h3>
                <p class="flush--bottom">@Messages("tai.incomeTaxSummary.annualAmounts.section.taxFreePara")</p>
                <p class="flush">
                    <span class="visually-hidden">@Messages("tai.incomeTaxSummary.generalAmount.prefix") </span>
                    <span class="display-block heading-36 faded-text-dark section--narrow flush">@viewModel.taxFreeAmount</span>
                </p>
                <p class="flush--top">
                    @link(
                        id=Some("taxFreeAmountLink"),
                        url=routes.TaxFreeAmountController.taxFreeAmount.toString,
                        copy=Messages("tai.incomeTaxSummary.annualAmounts.section.taxFreeLink")
                    )
                </p>
                <h3>@Messages("tai.incomeTaxSummary.annualAmounts.section.incomeTaxHeading")</h3>
                <p class="flush--bottom">@Messages("tai.incomeTaxSummary.annualAmounts.section.incomeTaxPara")</p>
                <p class="flush">
                    <span class="visually-hidden">@Messages("tai.incomeTaxSummary.generalAmount.prefix") </span>
                    <span class="display-block heading-36 faded-text-dark section--narrow flush">@viewModel.estimatedIncomeTaxAmount</span>
                </p>
                <p class="flush--top">
                    @link(
                        id=Some("estimatedIncomeTaxLink"),
                        url=routes.EstimatedIncomeTaxController.estimatedIncomeTax.toString,
                        copy=Messages("tai.incomeTaxSummary.annualAmounts.section.incomeTaxLink")
                    )
                </p>
            </div>

            <div id="addMissingIncomeSourceSection" class="section section__box--shaded">

                <h2 id="addMissingIncomeSourceHeading" class="heading-section">@Messages("tai.incomeTaxSummary.addMissingIncome.section.heading")</h2>

                <ul>
                    <li>
                        <p class="icon icon-plus">
                            @link(
                                id=Some("addEmploymentLink"),
                                url=controllers.employments.routes.AddEmploymentController.addEmploymentName.toString,
                                copy=Messages("tai.incomeTaxSummary.addMissingIncome.section.employerLink")
                            )
                        </p>
                    </li>
                    <li>
                        <p class="icon icon-plus">
                            @link(
                                id=Some("addPensionLink"),
                                url=controllers.pensions.routes.AddPensionProviderController.addPensionProviderName.toString,
                                copy=Messages("add.missing.pension")
                            )
                        </p>
                    </li>
                    <li>
                        <p class="icon icon-plus">
                        @link(
                            id=Some("addInvestmentLink"),
                            url=appConfig.investmentIncomeLinkUrl,
                            copy=Messages("tai.incomeTaxSummary.addMissingIncome.section.investmentIncomeLink")
                            )
                        </p>
                    </li>
                    <li>
                        <p class="icon icon-plus">
                            @link(
                                id=Some("addOtherIncomeSourceLink"),
                                url=appConfig.otherIncomeLinkUrl,
                                copy=Messages("tai.incomeTaxSummary.addMissingIncome.section.otherLink")
                            )
                        </p>
                    </li>
                </ul>

            </div>
        </div>
    </div>
</div>
}
